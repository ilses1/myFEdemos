## 现状

* 项目当前没有显式接入 antd 的 `ConfigProvider theme.algorithm`，也没有主题状态管理与切换入口（只启用了 `antd: {}`）。

* 运行时入口在 [app.ts](file:///c:/Users/wusan/Desktop/myFEdemos/src/app.ts)，这里已经在做 layout 相关配置（菜单图标/折叠隐藏文案/隐藏头像），最适合继续扩展主题能力。

## 目标

* 在页面右上角提供“明/暗”切换控件。

* 切换后全局 antd 主题算法跟随变化（light 使用 `defaultAlgorithm`，dark 使用 `darkAlgorithm`）。

* 主题选择写入本地存储，刷新后保持；首次进入可跟随系统偏好作为默认值。

## 实现步骤

1. 扩展初始状态

   * 修改 [app.ts](file:///c:/Users/wusan/Desktop/myFEdemos/src/app.ts) 的 `getInitialState`：返回 `{ themeMode: 'light' | 'dark' }`（保留现有字段）。

   * 读取优先级：localStorage（如 `theme_mode`）优先，其次 `matchMedia('(prefers-color-scheme: dark)')`，最后默认 `light`。

   * 全部加 `typeof window !== 'undefined'` 保护，避免非浏览器环境报错。

2. 全局注入 antd 主题（动态可切换）

   * 在 [app.ts](file:///c:/Users/wusan/Desktop/myFEdemos/src/app.ts) 新增 `rootContainer`，用 antd `ConfigProvider` 包裹应用。

   * 在包裹组件里通过 `useModel('@@initialState')` 读取 `initialState.themeMode`，选择 `theme.defaultAlgorithm / theme.darkAlgorithm` 传给 `ConfigProvider`。

3. 增加右上角主题切换入口

   * 在 [app.ts](file:///c:/Users/wusan/Desktop/myFEdemos/src/app.ts) 的 `export const layout = (initData) => ({ ... })` 改为接收 `initialState/setInitialState` 参数。

   * 补 `rightContentRender`：渲染一个 `Switch` 或 `Button`（图标：Sun/Moon），点击后：

     * `setInitialState({ ...initialState, themeMode: next })`

     * 同步写入 localStorage（`theme_mode=dark|light`）

   * 同时根据 `themeMode` 覆盖 `navTheme`（例如：dark→`dark`，light→`light`），让侧边栏/头部视觉更一致（不会一直固定 dark）。

## 验证方式

* 启动开发环境后切换开关：页面整体颜色（含 antd 组件）应立即切换。

* 刷新页面：主题保持上次选择。

* 首次无存储：默认跟随系统深色偏好（若系统为深色则默认 dark）。

